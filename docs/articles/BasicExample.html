<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="How do you apply this method to real samples?
">
<title>Basic Example • nQuack</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Basic Example">
<meta property="og:description" content="How do you apply this method to real samples?
">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=G-YWYQ5CX5NC"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-YWYQ5CX5NC');
</script>
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">nQuack</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/BasicExample.html">Basic Example</a>
    <a class="dropdown-item" href="../articles/DataPreparation.html">Data Preparation</a>
    <a class="dropdown-item" href="../articles/ModelOptions.html">Model Options</a>
    <a class="dropdown-item" href="../articles/SimulateData.html">Simulate Data</a>
    <a class="dropdown-item" href="../articles/Outliers.html">Outliers</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav"></ul>
</div>

    
  </div>
</nav><div class="container template-article">



<script src="BasicExample_files/kePrint-0.0.1/kePrint.js"></script><link href="BasicExample_files/lightable-0.0.1/lightable.css" rel="stylesheet">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Basic Example</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/mgaynor1/nQuack/blob/HEAD/vignettes/BasicExample.Rmd" class="external-link"><code>vignettes/BasicExample.Rmd</code></a></small>
      <div class="d-none name"><code>BasicExample.Rmd</code></div>
    </div>

    
    
<p>Here we provide an example to show you how to apply this method on
real samples. All associated data files can be found in “data/” folder
in our <a href="https://github.com/mgaynor1/nQuack" class="external-link">github
repository</a>.</p>
<p>Time when reported is based on a MacBook Pro with Apple M2 Max, 12
core-cpu, and 32 GB memory. Not all functions in this package are able
to use multiple CPUs, however we note when functions are able to use
multiple cores. To speed up these analysis, we suggest array SLURM
submissions.</p>
<div class="section level2">
<h2 id="data-description">Data description<a class="anchor" aria-label="anchor" href="#data-description"></a>
</h2>
<p>In the “data/” folder found on this github, I provide three samples
of <i>Galax urceolata</i> that were collected in 2021 as part of my
dissertation. These samples have not been published, but will be
submitted to NCBI-SRA in the near future. This data was generated
through target enrichment with species-specific probes. These samples
include a diploid (MLG013), a triploid (MLG015), and a tetraploid
(MLG014).</p>
<p>The raw files were created by following the preprocessing steps
outlined in the ‘Data Preparation’.</p>
</div>
<div class="section level2">
<h2 id="data-preparation">Data preparation<a class="anchor" aria-label="anchor" href="#data-preparation"></a>
</h2>
<div class="section level3">
<h3 id="prepare-data">01. Prepare data<a class="anchor" aria-label="anchor" href="#prepare-data"></a>
</h3>
<p>Warning, this step takes a while and results in a file slightly
larger than the input BAM. The time taken in this step can likely be
reduce in the future, however, we keep this file large by conducting no
true filtering steps during this stage. I suggest running this on one
CPU over night on a cluster, though it may take multiple days to finish
depending on the data.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Set in and out paths of files</span></span>
<span><span class="va">inpath</span> <span class="op">&lt;-</span> <span class="st">"../data/01_raw/"</span></span>
<span><span class="va">outpath</span> <span class="op">&lt;-</span> <span class="st">"../data/02_prepared/"</span></span>
<span></span>
<span><span class="co"># List files in the inpath and remove their ending</span></span>
<span><span class="va">filelist</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">list.files</a></span><span class="op">(</span>path <span class="op">=</span> <span class="va">inpath</span>, pattern <span class="op">=</span> <span class="st">"*.bam"</span> <span class="op">)</span></span>
<span><span class="va">filelist</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span><span class="st">".bam"</span>, <span class="st">""</span>, <span class="va">filelist</span><span class="op">)</span></span>
<span></span>
<span><span class="kw">for</span><span class="op">(</span> <span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">filelist</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="fu">prepare_data_flag</span><span class="op">(</span><span class="va">filelist</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>, <span class="va">inpath</span>, <span class="va">outpath</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="process-data-">02. Process data.<a class="anchor" aria-label="anchor" href="#process-data-"></a>
</h3>
<p>Next up, we filter the data file.</p>
<p>This step is fast (2 - 3 seconds per sample) and can be run locally
on a single CPU. Here we are following the filtering approach found in
nQuire: a minimum depth of 10, allele trunctation minimum of 0.15, and
allele truncation maximum of 0.85.</p>
<p>Why are we filtering like this? The most accurate model for this
sample set was under this filtering approach using the normal
distribution implementation with alpha free and a uniform mixture. This
model and filtering approach led to a 97% accuracy with 186 samples
ploidal level correctly assigned.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">inpathtext</span> <span class="op">&lt;-</span> <span class="st">"../data/02_prepared/"</span></span>
<span><span class="va">newfilelist</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">list.files</a></span><span class="op">(</span>path <span class="op">=</span> <span class="va">inpathtext</span>, pattern <span class="op">=</span> <span class="st">"*.txt"</span> <span class="op">)</span></span>
<span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">newfilelist</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="va">samp</span> <span class="op">&lt;-</span> <span class="va">newfilelist</span><span class="op">[</span><span class="va">i</span><span class="op">]</span></span>
<span>    <span class="va">temp</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/process_data.html">process_data</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">inpathtext</span>, <span class="va">samp</span><span class="op">)</span>, </span>
<span>                         min.depth <span class="op">=</span> <span class="fl">10</span>, </span>
<span>                         max.depth.quantile.prob <span class="op">=</span> <span class="fl">1</span>, </span>
<span>                         error <span class="op">=</span> <span class="fl">0.01</span>, </span>
<span>                         trunc <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.15</span>,<span class="fl">0.85</span><span class="op">)</span><span class="op">)</span></span>
<span>  </span>
<span>  </span>
<span>    <span class="fu"><a href="https://rdrr.io/r/utils/write.table.html" class="external-link">write.csv</a></span><span class="op">(</span><span class="va">temp</span>, </span>
<span>              file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"../data/03_processed/"</span>, <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span><span class="st">".txt"</span>, <span class="st">""</span>, <span class="va">samp</span><span class="op">)</span>, <span class="st">".csv"</span><span class="op">)</span>,</span>
<span>              row.names <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="model-inference">Model inference<a class="anchor" aria-label="anchor" href="#model-inference"></a>
</h2>
<div class="section level3">
<h3 id="explore-all-models">Explore all models<a class="anchor" aria-label="anchor" href="#explore-all-models"></a>
</h3>
<p>Now we are ready to predict the ploidal level of these samples. When
you are using this method on an unexplored sample set, we suggest to
examine the data under at least 18 model types for all three
distributions, a total of 54 models.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">samples</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"MLG013"</span>, <span class="st">"MLG014"</span>, <span class="st">"MLG015"</span><span class="op">)</span></span>
<span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">samples</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">temp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.csv</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"../data/03_processed/"</span>, <span class="va">samples</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>, <span class="st">".csv"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">out1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/quackNormal.html">quackNormal</a></span><span class="op">(</span>xm <span class="op">=</span> <span class="va">temp</span>, samplename <span class="op">=</span> <span class="va">samples</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>, cores <span class="op">=</span> <span class="fl">10</span>, parallel <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span>  <span class="va">out2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/quackBeta.html">quackBeta</a></span><span class="op">(</span>xm <span class="op">=</span> <span class="va">temp</span>, samplename <span class="op">=</span> <span class="va">samples</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>, cores <span class="op">=</span> <span class="fl">10</span>, parallel <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span>  <span class="va">out3</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/quackBetaBinom.html">quackBetaBinom</a></span><span class="op">(</span>xm <span class="op">=</span> <span class="va">temp</span>, samplename <span class="op">=</span> <span class="va">samples</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>, cores <span class="op">=</span> <span class="fl">10</span>, parallel <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span>  <span class="va">allout</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">out1</span>, <span class="va">out2</span>, <span class="va">out3</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/write.table.html" class="external-link">write.csv</a></span><span class="op">(</span><span class="va">allout</span>, </span>
<span>            file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"../data/04_output/"</span>, <span class="va">samples</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>, <span class="st">".csv"</span><span class="op">)</span>,</span>
<span>            row.names <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>To run these examples, it took us between 1.46 - 2.09 seconds to run
<code><a href="../reference/quackNormal.html">quackNormal()</a></code>, 6.41 - 23.16 min to run
<code><a href="../reference/quackBeta.html">quackBeta()</a></code>, and 3.12 - 27.85 min to run
<code><a href="../reference/quackBetaBinom.html">quackBetaBinom()</a></code>. In total, it took 9.54 to 46.15 min to
run all models for a sample.</p>
<table class="table  lightable-paper lightable-hover" style='font-family: "Arial Narrow", arial, helvetica, sans-serif; width: auto !important; margin-left: auto; margin-right: auto;border-bottom: 0;'>
<thead><tr>
<th style="text-align:left;">
sample
</th>
<th style="text-align:right;">
total
</th>
<th style="text-align:right;">
normal
</th>
<th style="text-align:right;">
beta
</th>
<th style="text-align:right;">
beta.binomial
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
MLG013
</td>
<td style="text-align:right;">
572.4812
</td>
<td style="text-align:right;">
1.46
</td>
<td style="text-align:right;">
384.56
</td>
<td style="text-align:right;">
186.45
</td>
</tr>
<tr>
<td style="text-align:left;">
MLG014
</td>
<td style="text-align:right;">
2769.2193
</td>
<td style="text-align:right;">
2.09
</td>
<td style="text-align:right;">
1095.89
</td>
<td style="text-align:right;">
1671.24
</td>
</tr>
<tr>
<td style="text-align:left;">
MLG015
</td>
<td style="text-align:right;">
2380.6057
</td>
<td style="text-align:right;">
1.81
</td>
<td style="text-align:right;">
1389.82
</td>
<td style="text-align:right;">
988.98
</td>
</tr>
</tbody>
<tfoot>
<tr>
<td style="padding: 0; " colspan="100%">
<span style="font-style: italic;">Note: </span>
</td>
</tr>
<tr>
<td style="padding: 0; " colspan="100%">
<sup></sup> Time in seconds.
</td>
</tr>
</tfoot>
</table>
</div>
<div class="section level3">
<h3 id="model-interpretation">Model interpretation<a class="anchor" aria-label="anchor" href="#model-interpretation"></a>
</h3>
<p>Using our function <code><a href="../reference/quackit.html">quackit()</a></code>, you can easily interpret
model output. Here we are selecting models based on the BIC score and
only considering diploid, triploid, and tetraploid mixtures.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">inpathtext</span> <span class="op">&lt;-</span> <span class="st">"../data/04_output/"</span></span>
<span><span class="va">samples</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"MLG013"</span>, <span class="st">"MLG014"</span>, <span class="st">"MLG015"</span><span class="op">)</span></span>
<span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">samples</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">temp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.csv</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">inpathtext</span>, <span class="va">samples</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>, <span class="st">".csv"</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">summary</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/quackit.html">quackit</a></span><span class="op">(</span>model_out <span class="op">=</span>  <span class="va">temp</span>, </span>
<span>                     summary_statistic <span class="op">=</span> <span class="st">"BIC"</span>, </span>
<span>                     mixtures <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"diploid"</span>, <span class="st">"triploid"</span>, <span class="st">"tetraploid"</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/write.table.html" class="external-link">write.csv</a></span><span class="op">(</span><span class="va">summary</span>, </span>
<span>            file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"../data/05_interpret/"</span>, <span class="va">samples</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>, <span class="st">".csv"</span><span class="op">)</span>,</span>
<span>            row.names <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>Once we have this output for all our sample, we can pair the outputs
with a key that contains sample names and their ploidal level. To
identify the most accurate model for your data, we tally the accuracy
with some handy <code>dplyr</code> functions.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span> <span class="co"># Create key</span></span>
<span><span class="va">key</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>sample <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"MLG013"</span>, <span class="st">"MLG014"</span>, <span class="st">"MLG015"</span><span class="op">)</span>, </span>
<span>           ploidal.level <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"diploid"</span>, <span class="st">"tetraploid"</span>, <span class="st">"triploid"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Read in quackit() output</span></span>
<span><span class="va">dfs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">list.files</a></span><span class="op">(</span><span class="st">"../data/05_interpret/"</span>, full.names <span class="op">=</span> <span class="cn">TRUE</span>  <span class="op">)</span>, <span class="va">read.csv</span><span class="op">)</span></span>
<span><span class="va">alloutput</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="va">rbind</span>, <span class="va">dfs</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Combined</span></span>
<span><span class="va">alloutputcombo</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">alloutput</span>, <span class="va">key</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Check the accuracy</span></span>
<span><span class="va">alloutputcombo</span> <span class="op">&lt;-</span> <span class="va">alloutputcombo</span> <span class="op">%&gt;%</span></span>
<span>                  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>accuracy <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">winnerBIC</span> <span class="op">==</span> <span class="va">ploidal.level</span>, <span class="fl">1</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## What distribution and model type should we use?</span></span>
<span><span class="va">sumcheck</span> <span class="op">&lt;-</span> <span class="va">alloutputcombo</span> <span class="op">%&gt;%</span> </span>
<span>            <span class="fu">group_by</span><span class="op">(</span><span class="va">Distribution</span>, <span class="va">Type</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>            <span class="fu">summarize</span><span class="op">(</span>total <span class="op">=</span> <span class="fu">n</span><span class="op">(</span><span class="op">)</span>, correct <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">accuracy</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">kbl</span><span class="op">(</span><span class="va">sumcheck</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">kable_paper</span><span class="op">(</span><span class="st">"hover"</span>, full_width <span class="op">=</span> <span class="cn">F</span><span class="op">)</span> </span></code></pre></div>
<table class="table  lightable-paper lightable-hover" style='font-family: "Arial Narrow", arial, helvetica, sans-serif; width: auto !important; margin-left: auto; margin-right: auto;'>
<thead><tr>
<th style="text-align:left;">
Distribution
</th>
<th style="text-align:left;">
Type
</th>
<th style="text-align:right;">
total
</th>
<th style="text-align:right;">
correct
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
beta
</td>
<td style="text-align:left;">
fixed
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
2
</td>
</tr>
<tr>
<td style="text-align:left;">
beta
</td>
<td style="text-align:left;">
fixed_2
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:left;">
beta
</td>
<td style="text-align:left;">
fixed_3
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
2
</td>
</tr>
<tr>
<td style="text-align:left;">
beta-binomial
</td>
<td style="text-align:left;">
fixed
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:left;">
beta-binomial
</td>
<td style="text-align:left;">
fixed_2
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
2
</td>
</tr>
<tr>
<td style="text-align:left;">
beta-binomial
</td>
<td style="text-align:left;">
fixed_3
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
3
</td>
</tr>
<tr>
<td style="text-align:left;">
beta-binomial-uniform
</td>
<td style="text-align:left;">
fixed
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:left;">
beta-binomial-uniform
</td>
<td style="text-align:left;">
fixed_2
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
2
</td>
</tr>
<tr>
<td style="text-align:left;">
beta-binomial-uniform
</td>
<td style="text-align:left;">
fixed_3
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
3
</td>
</tr>
<tr>
<td style="text-align:left;">
beta-uniform
</td>
<td style="text-align:left;">
fixed
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
2
</td>
</tr>
<tr>
<td style="text-align:left;">
beta-uniform
</td>
<td style="text-align:left;">
fixed_2
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
2
</td>
</tr>
<tr>
<td style="text-align:left;">
beta-uniform
</td>
<td style="text-align:left;">
fixed_3
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
2
</td>
</tr>
<tr>
<td style="text-align:left;">
normal
</td>
<td style="text-align:left;">
fixed
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:left;">
normal
</td>
<td style="text-align:left;">
fixed_2
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:left;">
normal
</td>
<td style="text-align:left;">
fixed_3
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
2
</td>
</tr>
<tr>
<td style="text-align:left;">
normal-uniform
</td>
<td style="text-align:left;">
fixed
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
3
</td>
</tr>
<tr>
<td style="text-align:left;">
normal-uniform
</td>
<td style="text-align:left;">
fixed_2
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:left;">
normal-uniform
</td>
<td style="text-align:left;">
fixed_3
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
2
</td>
</tr>
</tbody>
</table>
<p>For this sample set, we know the normal distribution with alpha free
and a uniform mixture is the most accurate model. So now what?</p>
</div>
<div class="section level3">
<h3 id="running-only-the-best-model">Running only the best model<a class="anchor" aria-label="anchor" href="#running-only-the-best-model"></a>
</h3>
<p>For unknown samples, you can use the best model to predict their
ploidal level with our <code><a href="../reference/bestquack.html">bestquack()</a></code> function.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">samples</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"MLG013"</span>, <span class="st">"MLG014"</span>, <span class="st">"MLG015"</span><span class="op">)</span></span>
<span><span class="va">out</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">samples</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">temp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.csv</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"../data/03_processed/"</span>, <span class="va">samples</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>, <span class="st">".csv"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">out</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/bestquack.html">bestquack</a></span><span class="op">(</span><span class="va">temp</span>, </span>
<span>                      distribution <span class="op">=</span> <span class="st">"normal"</span>,</span>
<span>                      type <span class="op">=</span> <span class="st">"fixed"</span>,</span>
<span>                      uniform <span class="op">=</span> <span class="fl">1</span>, </span>
<span>                      mixtures <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"diploid"</span>, <span class="st">"triploid"</span>, <span class="st">"tetraploid"</span><span class="op">)</span>, </span>
<span>                      samplename <span class="op">=</span> <span class="va">samples</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="bootstrap-replicates">Bootstrap replicates<a class="anchor" aria-label="anchor" href="#bootstrap-replicates"></a>
</h3>
<p>We also provide a function to run bootstrap replicates with the best
model. Warning, this will print a lot of ducks.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">samples</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"MLG013"</span>, <span class="st">"MLG014"</span>, <span class="st">"MLG015"</span><span class="op">)</span></span>
<span><span class="va">bout</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">samples</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">temp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.csv</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"../data/03_processed/"</span>, <span class="va">samples</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>, <span class="st">".csv"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">bout</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/quackNboots.html">quackNboots</a></span><span class="op">(</span><span class="va">temp</span>, </span>
<span>                        nboots <span class="op">=</span> <span class="fl">100</span>,</span>
<span>                      distribution <span class="op">=</span> <span class="st">"normal"</span>,</span>
<span>                      type <span class="op">=</span> <span class="st">"fixed"</span>,</span>
<span>                      uniform <span class="op">=</span> <span class="fl">1</span>, </span>
<span>                      mixtures <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"diploid"</span>, <span class="st">"triploid"</span>, <span class="st">"tetraploid"</span><span class="op">)</span>, </span>
<span>                      samplename <span class="op">=</span> <span class="va">samples</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/write.table.html" class="external-link">write.csv</a></span><span class="op">(</span><span class="va">bout</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>, file <span class="op">=</span> <span class="st">"../data/06_boots/MLG013-boots.csv"</span>, row.names <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/write.table.html" class="external-link">write.csv</a></span><span class="op">(</span><span class="va">bout</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span>, file <span class="op">=</span> <span class="st">"../data/06_boots/MLG014-boots.csv"</span>, row.names <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/write.table.html" class="external-link">write.csv</a></span><span class="op">(</span><span class="va">bout</span><span class="op">[[</span><span class="fl">3</span><span class="op">]</span><span class="op">]</span>, file <span class="op">=</span> <span class="st">"../data/06_boots/MLG015-boots.csv"</span>, row.names <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<p>The output of this function includes two rows, the first show the
best model for the original data set, and the second tallies the
bootstrap replicates best model. Here for our diploid, we see the best
model for all replicates is a diploid! This means 100% bootstrap
support.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">MLG013boot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.csv</a></span><span class="op">(</span><span class="st">"../data/06_boots/MLG013-boots.csv"</span><span class="op">)</span></span>
<span><span class="va">MLG013boot</span></span></code></pre></div>
<pre><code><span><span class="co">##   diploid triploid tetraploid sample</span></span>
<span><span class="co">## 1       1       NA         NA MLG013</span></span>
<span><span class="co">## 2     100       NA         NA MLG013</span></span></code></pre>
<p>We can use these replicates to identify when a model shouldn’t be
trusted. For example, this model is known to missassign ploidal level to
MLG129, a tetraploid.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span>  <span class="va">temp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.csv</a></span><span class="op">(</span><span class="st">"../data/06_boots/MLG129.csv"</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">check</span>  <span class="op">&lt;-</span> <span class="fu"><a href="../reference/quackNboots.html">quackNboots</a></span><span class="op">(</span><span class="va">temp</span>, </span>
<span>                        nboots <span class="op">=</span> <span class="fl">1000</span>,</span>
<span>                        distribution <span class="op">=</span> <span class="st">"normal"</span>,</span>
<span>                        type <span class="op">=</span> <span class="st">"fixed"</span>,</span>
<span>                        uniform <span class="op">=</span> <span class="fl">1</span>, </span>
<span>                        mixtures <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"diploid"</span>, <span class="st">"triploid"</span>, <span class="st">"tetraploid"</span><span class="op">)</span>, </span>
<span>                        samplename <span class="op">=</span> <span class="st">"MLG129"</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/write.table.html" class="external-link">write.csv</a></span><span class="op">(</span><span class="va">check</span>, file <span class="op">=</span> <span class="st">"../data/06_boots/MLG129-boots.csv"</span>, row.names <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<p>Here we found that only 4/1000 bootstrap replicates support the
correct model. Suggesting that any deviation from one mixture/ploidal
level may indicate an untrustworthy model. However, this likely varies
across models and sample sets.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">MLG129boot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.csv</a></span><span class="op">(</span><span class="st">"../data/06_boots/MLG129-boots.csv"</span><span class="op">)</span></span>
<span><span class="va">MLG129boot</span></span></code></pre></div>
<pre><code><span><span class="co">##   diploid triploid tetraploid sample</span></span>
<span><span class="co">## 1       1       NA         NA MLG129</span></span>
<span><span class="co">## 2     996       NA          4 MLG129</span></span></code></pre>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Michelle L. Gaynor.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
